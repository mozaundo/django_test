######################## BEGIN LICENSE BLOCK ########################
# The Original Code is Mozilla Communicator client code.
#
# The Initial Developer of the Original Code is
# Netscape Communications Corporation.
# Portions created by the Initial Developer are Copyright (C) 1998
# the Initial Developer. All Rights Reserved.
#
# Contributor(s):
#   Mark Pilgrim - port to Python
#
# This library is free software; you can redistribute it and/or
# modify it under the terms of the GNU Lesser General Public
# License as published by the Free Software Foundation; either
# version 2.1 of the License, or (at your option) any later version.
#
# This library is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# Lesser General Public License for more details.
#
# You should have received a copy of the GNU Lesser General Public
# License along with this library; if not, write to the Free Software
# Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
# 02110-1301  USA
######################### END LICENSE BLOCK #########################

from .big5freq import (
    BIG5_CHAR_TO_FREQ_ORDER,
    BIG5_TABLE_SIZE,
    BIG5_TYPICAL_DISTRIBUTION_RATIO,
)
from .euckrfreq import (
    EUCKR_CHAR_TO_FREQ_ORDER,
    EUCKR_TABLE_SIZE,
    EUCKR_TYPICAL_DISTRIBUTION_RATIO,
)
from .euctwfreq import (
    EUCTW_CHAR_TO_FREQ_ORDER,
    EUCTW_TABLE_SIZE,
    EUCTW_TYPICAL_DISTRIBUTION_RATIO,
)
from .gb2312freq import (
    GB2312_CHAR_TO_FREQ_ORDER,
    GB2312_TABLE_SIZE,
    GB2312_TYPICAL_DISTRIBUTION_RATIO,
)
from .jisfreq import (
    JIS_CHAR_TO_FREQ_ORDER,
    JIS_TABLE_SIZE,
    JIS_TYPICAL_DISTRIBUTION_RATIO,
)
from .johabfreq import JOHAB_TO_EUCKR_ORDER_TABLE


class CharDistributionAnalysis:
    ENOUGH_DATA_THRESHOLD = 1024
    SURE_YES = 0.99
    SURE_NO = 0.01
    MINIMUM_DATA_THRESHOLD = 3

    def __init__(self):
        # Mapping table to get frequency order from char order (get from
        # GetOrder())
        self._char_to_freq_order = tuple()
        self._table_size = None  # Size of above table
        # This is a constant value which varies from language to language,
        # used in calculating confidence.  See
        # http://www.mozilla.org/projects/intl/UniversalCharsetDetection.html
        # for further detail.
        self.typical_distribution_ratio = None
        self._done = None
        self._total_chars = None
        self._freq_chars = None
        self.reset()

    def reset(self):
        """reset analyser, clear any state"""
        # If this flag is set to True, detection is done and conclusion has
        # been made
        self._done = False
        self._total_chars = 0  # Total characters encountered
        # The number of characters whose frequency order is less than 512
        self._freq_chars = 0

    def feed(self, char, char_len):
        """feed a character with known length"""
        if char_len == 2:
            # we only care about 2-bytes character in our distribution analysis
            order = self.get_order(char)
        else:
            order = -1
        if order >= 0:
            self._total_chars += 1
            # order is valid
            if order < self._table_size:
                if 512 > self._char_to_freq_order[order]:
                    self._freq_chars += 1

    def get_confidence(self):
        """return confidence based on existing data"""
        # if we didn't receive any character in our consideration range,
        # return negative answer
        if self._total_chars <= 0 or self._freq_chars <= self.MINIMUM_DATA_THRESHOLD:
            return self.SURE_NO

        if self._total_chars != self._freq_chars:
            r = self._freq_chars / (
                (self._total_chars - self._freq_chars) * self.typical_distribution_ratio
            )
            if r < self.SURE_YES:
                return r

        # normalize confidence (we don't want to be 100% sure)
        return self.SURE_YES

    def got_enough_data(self):
     du","activeSheetAriaLabel":"Aktivni list","hiddenSheetAriaLabel":"Skriveni list","sheetAriaLabel":"List","chartAriaLabel":"Grafikon","namedRangeAriaLabel":"Imenovani opseg","pivotTableAriaLabel":"Izvedena tabela","shapeAriaLabel":"Oblik","tableAriaLabel":"Tabela","sheetHeaderAriaLabel":"{0} {1}","sheetItemAriaLabel":"{0} {1} {2} {3}","renameContextMenuItemText":"Preimenuj","deleteContextMenuItemText":"Izbriši","showContextMenuItemText":"Prikaži","hideContextMenuItemText":"Sakrij","requireVisibleSheetErrorText":"Radna sveska mora da sadrži bar jedan vidljivi radni list. \\n\\nDa biste sakrili, izbrisali ili premestili izabrane listove, najpre morate da umetnete novi list ili da otkrijete list koji je već sakriven.","errorDialogTitle":"Microsoft Excel","invalidNameErrorText":"Sintaksa ovog imena nije ispravna.","invalidCharactersInSheetNameErrorText":"Ime ne može da sadrži neki od sledećih znakova: \\\\ / ? * [ or ].","emptySheetNameErrorText":"Ime lista ne sme biti prazno.","conflictingSheetNameErrorText":"Već postoji list sa tim imenom. Probajte sa drugim.","visibleSheetItemAnnouncementMessage":"Broj prikazanih stavki radnog lista: {0}."}')},function(e){e.exports=JSON.parse('{"deleteSheetDialogTitle":"Microsoft Excel","deleteSheetDialogSubtext":"Kalkyl bladet tas bort permanent i Microsoft Excel. Vill du fortsätta?","deleteButtonText":"Ta bort","cancelButtonText":"Avbryt","searchBoxAriaLabel":"Sök i","searchBoxPlaceholderText":"Sök efter tabeller, diagram och mer...","renameDialogTitle":"Byt namn","renameDialogLabelText":"Byt namn till:","okButtonText":"OK","activeSheetAriaLabel":"Aktivt blad","hiddenSheetAriaLabel":"Dolt blad","sheetAriaLabel":"Blad","chartAriaLabel":"Diagram","namedRangeAriaLabel":"Namngivet område","pivotTableAriaLabel":"Pivottabell","shapeAriaLabel":"Figur","tableAriaLabel":"Tabell","sheetHeaderAriaLabel":"{0} {1}","sheetItemAriaLabel":"{0} {1} {2} {3}","renameContextMenuItemText":"Byt namn","deleteContextMenuItemText":"Ta bort","showContextMenuItemText":"Visa","hideContextMenuItemText":"Dölj","requireVisibleSheetErrorText":"En arbetsbok måste innehålla minst ett synligt kalkylblad.\\n\\nOm du vill dölja, ta bort eller flytta det markerade bladet(en) måste du först infoga ett nytt blad eller ta fram ett dolt blad.","errorDialogTitle":"Microsoft Excel","invalidNameErrorText":"Syntaxen för det här namnet är inte korrekt.","invalidCharactersInSheetNameErrorText":"Bladnamn får inte innehålla något av följande tecken: : \\\\ / ? * [ eller ].","emptySheetNameErrorText":"Bladnamn får inte vara tomt.","conflictingSheetNameErrorText":"Det finns redan ett blad med det namnet. Försök med ett annat.","visibleSheetItemAnnouncementMessage":"{0} kalkylbladsobjekt visas."}')},function(e){e.exports=JSON.parse('{"deleteSheetDialogTitle":"Microsoft Excel","deleteSheetDialogSubtext":"Microsoft Excel இந்தப் பணித்தாளை நிரந்தரமாக நீக்கும். தொடர விரும்புகிறீர்களா?","deleteButtonText":"நீக்கு","cancelButtonText":"ரத்து","searchBoxAriaLabel":"தேடுக","searchBoxPlaceholderText":"அட்டவணைகள், விளக்கப்படங்கள் மற்றும் பலவற்றைத் தேடவும்...","renameDialogTitle":"மறுபெயரிடு","renameDialogLabelText":"இதற்கு மறுபெயரிடு:","okButtonText":"சரி","activeSheetAriaLabel":"நடப்புத் தாள்","hiddenSheetAriaLabel":"மறைக்கப்பட்ட தாள்","sheetAriaLabel":"பணித்தாள்","chartAriaLabel":"விளக்கப்படம்","namedRangeAriaLabel":"பெயரிடப்பட்ட வரம்பு","pivotTableAriaLabel":"PivotTable","shapeAriaLabel":"வடிவம்","tableAriaLabel":"அட்டவணை","sheetHeaderAriaLabel":"{0} {1}","sheetItemAriaLabel":"{0} {1} {2} {3}","renameContextMenuItemText":"மறுபெயரிடு","deleteContextMenuItemText":"நீக்கு","showContextMenuItemText":"காட்டு","hideContextMenuItemText":"மறை","requireVisibleSheetErrorText":"ஒரு பணிப்புத்தகத்தில் குறைந்தது ஒரு தெரியும்படியான பணித்தாள் இருக்க வேண்டும்.\\n\\nதேர்நதெடுத்த தா(ட்க)ளை மறைக்க, நீக்க அல்லது நகர்த்த முதலில் நீங்கள் ஒரு புதிய தாளைச் செருக வேண்டும் அல்லது ஏற்கெனவே மறைக்கப்பட்டுள்ள ஒரு தாளின் மறைப்புநீக்கவும்.","errorDialogTitle":"Microsoft Excel","invalidNameErrorText":"இந்த பெயரின் தொடரியல் சரியானது அல்ல.","invalidCharactersInSheetNameErrorText":"தாள் பெயரில் பின்வரும் எழுத்துக்குறிகள் எதுவும் இருக்க முடியாது: : \\\\ / ? * [ or ].","emptySheetNameErrorText":"தாளின் பெயர் காலியாக இருக்கக்கூடாது.","conflictingSheetNameErrorText":"இப்பெயரில் ஏற்க